"0","#bring in urban areas dataset"
"0","urban_file = 'tl_2023_us_uac20.shp'"
"0","urban_shape = read_sf(file.path(paste0(project_dir, ""/Data/Census Shapefiles/tl_2023_us_uac20/"", urban_file)))"
"0",""
"0","#extract or and wa urban areas"
"0","urban_shape = urban_shape %>%"
"0","  filter(grepl('OR|WA', NAME20)) %>% "
"0","  filter(!grepl('ID', NAME20))"
"0",""
"0","urban_agg = urban_shape %>% "
"0","  st_union() %>% "
"0","  st_cast(""POLYGON"") %>% "
"0","  as.data.frame(urban_shape) %>% "
"0","  mutate(urban = ""urban"") %>% "
"0","  st_sf()"
"0",""
"0","#isolate urban areas with mcmenamins "
"0","urban_mcmen_shape = urban_shape[mcmen_loc, ] %>% "
"0","  st_union() %>% "
"0","  st_cast(""POLYGON"") %>% "
"0","  as.data.frame(urban_shape) %>% "
"0","  mutate(urban_mc_men = ""urban with mcmens"") %>% "
"0","  st_sf()"
"0","urban_mcmen = data.frame(urban_mcmen_shape)"
"0",""
"0","#isolate urban areas with no mcmenamins "
"0","urban_no_mcmen_shape = st_sf(urban_shape[is.na(sp::over(as_Spatial(urban_shape), sp::geometry(as_Spatial(mcmen_loc)))),]) %>% "
"0","  st_union() %>% "
"0","  st_cast(""POLYGON"") %>% "
"0","  as.data.frame(urban_shape) %>% "
"0","  mutate(urban_mc_men = ""urban no mcmens"") %>% "
"0","  st_sf()"
"0","urban_no_mcmen = data.frame(urban_no_mcmen_shape)"
"0",""
"0",""
"0","##all urban"
"0","###join urban areas to tracts"
"0","or_tracts_shape = or_tracts_shape %>% "
"0","  dplyr::mutate(area_km2 = (ALAND + AWATER)/1000000)"
"0","urban_or_tracts = or_tracts_shape[urban_agg,]"
"0","urban_oregon_split = st_intersection(urban_or_tracts, urban_agg)"
"2","Warning: attribute variables are assumed to be spatially constant throughout all geometries"
"0","wa_tracts_shape = wa_tracts_shape %>% "
"0","  dplyr::mutate(area_km2 = (ALAND + AWATER)/1000000)"
"0","urban_wa_tracts = wa_tracts_shape[urban_agg,]"
"0","urban_wash_split = st_intersection(urban_wa_tracts, urban_agg)"
"2","Warning: attribute variables are assumed to be spatially constant throughout all geometries"
"0","split_tracts = bind_rows(urban_oregon_split, urban_wash_split)"
"0",""
"0","##urban areas w mcmenamins"
"0","###join urban areas to tracts"
"0","urban_mcmen_or_tracts = or_tracts_shape[urban_mcmen_shape,]"
"0","urban_mcmen_oregon_split = st_intersection(urban_or_tracts, urban_mcmen_shape)"
"2","Warning: attribute variables are assumed to be spatially constant throughout all geometries"
"0","urban_mcmen_wa_tracts = wa_tracts_shape[urban_mcmen_shape,]"
"0","urban_mcmen_wash_split = st_intersection(urban_wa_tracts, urban_mcmen_shape)"
"2","Warning: attribute variables are assumed to be spatially constant throughout all geometries"
"0","split_mcmen_tracts = bind_rows(urban_mcmen_oregon_split, urban_mcmen_wash_split)"
"0",""
"0","##urban areas w/out mcmenamins"
"0","###join urban areas to tracts"
"0","urban_no_mcmen_or_tracts = or_tracts_shape[urban_no_mcmen_shape,]"
"0","urban_no_mcmen_oregon_split = st_intersection(urban_or_tracts, urban_no_mcmen_shape)"
"2","Warning: attribute variables are assumed to be spatially constant throughout all geometries"
"0","urban_no_mcmen_wa_tracts = wa_tracts_shape[urban_no_mcmen_shape,]"
"0","urban_no_mcmen_wash_split = st_intersection(urban_wa_tracts, urban_no_mcmen_shape)"
"2","Warning: attribute variables are assumed to be spatially constant throughout all geometries"
"0","split_no_mcmen_tracts = bind_rows(urban_no_mcmen_oregon_split, urban_no_mcmen_wash_split)"
"0",""
"0","##clean split tracts"
"0","sf_use_s2(FALSE)"
"2","Spherical geometry (s2) switched off
"
"0","split_tracts = split_tracts %>% "
"0","  st_collection_extract(type = ""POLYGON"")"
"0",""
"0","split_tracts = split_tracts %>% "
"0","  mutate(split_area_km2 = st_area(split_tracts)/1000000)"
"0",""
"0","split_tracts = split_tracts %>% "
"0","  st_make_valid()"
"0",""
"0","any(is.na(st_dimension(split_tracts)))"
"1","[1]"
"1"," FALSE"
"1","
"
"0","any(is.na(st_is_valid(split_tracts)))"
"1","[1]"
"1"," FALSE"
"1","
"
"0","any(na.omit(st_is_valid(split_tracts)) == FALSE)"
"1","[1]"
"1"," FALSE"
"1","
"
"0","split_tracts = split_tracts %>% "
"0","  st_collection_extract(type = ""POLYGON"")"
"0",""
"0","split_tracts_sum = split_tracts %>% "
"0","  group_by(GEOID) %>% "
"0","  summarise(NAME = first(NAME),"
"0","  NAMELSAD = first(NAMELSAD),"
"0","  state = first(STATEFP),"
"0","  area_km2 = first(area_km2),"
"0","  urban = first(urban),"
"0","  split_area = as.numeric(format(as.numeric(sum(split_area_km2)), nsmall = 4)))"
"2","although coordinates are longitude/latitude, st_union assumes that they are planar
"
"0","##clean split MCMEN tracts"
"0","split_mcmen_tracts = split_mcmen_tracts %>% "
"0","  st_collection_extract(type = ""POLYGON"")"
"0",""
"0","split_mcmen_tracts = split_mcmen_tracts %>% "
"0","  mutate(split_mcmen_area_km2 = st_area(split_mcmen_tracts)/1000000)"
"0",""
"0","split_mcmen_tracts = split_mcmen_tracts %>% "
"0","  st_make_valid()"
"0",""
"0","any(is.na(st_dimension(split_mcmen_tracts)))"
"1","[1]"
"1"," FALSE"
"1","
"
"0","any(is.na(st_is_valid(split_mcmen_tracts)))"
"1","[1]"
"1"," FALSE"
"1","
"
"0","any(na.omit(st_is_valid(split_mcmen_tracts)) == FALSE)"
"1","[1]"
"1"," FALSE"
"1","
"
"0","split_mcmen_tracts = split_mcmen_tracts %>% "
"0","  st_collection_extract(type = ""POLYGON"")"
"0",""
"0","split_mcmen_tracts_sum = split_mcmen_tracts %>% "
"0","  group_by(GEOID) %>% "
"0","  summarise(NAME = first(NAME),"
"0","  NAMELSAD = first(NAMELSAD),"
"0","  state = first(STATEFP),"
"0","  area_km2 = first(area_km2),"
"0","  urban_mc_men = first(urban_mc_men),"
"0","  split_mcmen_area = as.numeric(format(as.numeric(sum(split_mcmen_area_km2)), nsmall = 4)))"
"2","although coordinates are longitude/latitude, st_union assumes that they are planar
"
"0","##clean split no mcmen tracts"
"0","split_no_mcmen_tracts = split_no_mcmen_tracts %>% "
"0","  st_collection_extract(type = ""POLYGON"")"
"0",""
"0","split_no_mcmen_tracts = split_no_mcmen_tracts %>% "
"0","  mutate(split_no_mcmen_area_km2 = st_area(split_no_mcmen_tracts)/1000000)"
"0",""
"0","split_no_mcmen_tracts = split_no_mcmen_tracts %>% "
"0","  st_make_valid()"
"0",""
"0","any(is.na(st_dimension(split_no_mcmen_tracts)))"
"1","[1]"
"1"," FALSE"
"1","
"
"0","any(is.na(st_is_valid(split_no_mcmen_tracts)))"
"1","[1]"
"1"," FALSE"
"1","
"
"0","any(na.omit(st_is_valid(split_no_mcmen_tracts)) == FALSE)"
"1","[1]"
"1"," FALSE"
"1","
"
"0","split_no_mcmen_tracts = split_no_mcmen_tracts %>% "
"0","  st_collection_extract(type = ""POLYGON"")"
"0",""
"0","split_no_mcmen_tracts_sum = split_no_mcmen_tracts %>% "
"0","  group_by(GEOID) %>% "
"0","  summarise(NAME = first(NAME),"
"0","  NAMELSAD = first(NAMELSAD),"
"0","  state = first(STATEFP),"
"0","  area_km2 = first(area_km2),"
"0","  urban_mc_men = first(urban_mc_men),"
"0","  split_no_mcmen_area = as.numeric(format(as.numeric(sum(split_no_mcmen_area_km2)), nsmall = 4)))"
"2","although coordinates are longitude/latitude, st_union assumes that they are planar
"
"0","#write out so I don't have to repeat steps!"
"0","st_write(split_tracts_sum, paste0(project_dir, ""/split_tracts_sum.shp""))"
"1","Writing layer `"
"1","split_tracts_sum"
"1","' to data source "
"1","`"
"1","C:/Users/evank/Documents/GitHub/Personal/mcmenamins/split_tracts_sum.shp"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Writing "
"1","2469"
"1"," features with "
"1","7"
"1"," fields"
"1"," and geometry type "
"1","Multi Polygon"
"1","."
"1","
"
"0","st_write(split_mcmen_tracts_sum, paste0(project_dir, ""/split_mcmen_tracts_sum.shp""))"
"2","Warning: Field names abbreviated for ESRI Shapefile driver"
"1","Writing layer `"
"1","split_mcmen_tracts_sum"
"1","' to data source "
"1","
"
"1","  "
"1","`"
"1","C:/Users/evank/Documents/GitHub/Personal/mcmenamins/split_mcmen_tracts_sum.shp"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Writing "
"1","1555"
"1"," features with "
"1","7"
"1"," fields"
"1"," and geometry type "
"1","Multi Polygon"
"1","."
"1","
"
"0","st_write(split_no_mcmen_tracts_sum, paste0(project_dir, ""/split_nomcmen_tracts_sum.shp""))"
"2","Warning: Field names abbreviated for ESRI Shapefile driver"
"1","Writing layer `"
"1","split_nomcmen_tracts_sum"
"1","' to data source "
"1","
"
"1","  "
"1","`"
"1","C:/Users/evank/Documents/GitHub/Personal/mcmenamins/split_nomcmen_tracts_sum.shp"
"1","' using driver `"
"1","ESRI Shapefile"
"1","'"
"1","
"
"1","Writing "
"1","936"
"1"," features with "
"1","7"
"1"," fields"
"1"," and geometry type "
"1","Multi Polygon"
"1","."
"1","
"
"0","#read in if re-running steps and don't want to read "
"0",""
"0",""
"0","#create ratios for finding pop statistics for urban areas"
"0","split_tracts_sum = split_tracts_sum %>% "
"0","  mutate(pop_ratio = split_area/area_km2)"
"0",""
"0","split_mcmen_tracts_sum = split_mcmen_tracts_sum %>% "
"0","  mutate(pop_ratio = split_mcmen_area/area_km2)"
"0",""
"0","split_no_mcmen_tracts_sum = split_no_mcmen_tracts_sum %>% "
"0","  mutate(pop_ratio = split_no_mcmen_area/area_km2)"
"0",""
